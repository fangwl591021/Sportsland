<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運動島管理後台</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        [v-cloak] { display: none !important; }
        :root { --line-green: #06C755; --bg-body: #f5f6f8; --text-main: #111827; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg-body); color: var(--text-main); overflow: hidden; }
        .sidebar { width: 240px; background: white; border-right: 1px solid #e5e7eb; display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .menu-item { display: flex; align-items: center; width: 100%; height: 48px; padding: 0 20px; color: #4b5563; font-size: 14px; font-weight: 500; cursor: pointer; border-left: 4px solid transparent; transition: all 0.2s; }
        .menu-item.active { background-color: #f0fbf5; color: #06C755; border-left-color: #06C755; font-weight: 700; }
        .main-content { flex: 1; display: flex; flex-direction: column; background: #f0f2f5; overflow: hidden; }
        .top-header { height: 64px; background: white; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; padding: 0 32px; }
        .content-scroll { flex: 1; overflow-y: auto; padding: 32px; }
        .card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); margin-bottom: 24px; overflow: hidden; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { padding: 16px 24px; background: #f9fafb; color: #6b7280; font-size: 12px; font-weight: 700; border-bottom: 1px solid #e5e7eb; white-space: nowrap; }
        .data-table td { padding: 16px 24px; border-bottom: 1px solid #f3f4f6; font-size: 14px; }
        .btn-green { background: var(--line-green); color: white; padding: 8px 16px; border-radius: 6px; font-weight: 700; font-size: 14px; display: inline-flex; align-items: center; gap: 6px; transition: 0.2s; }
        .btn-white { background: white; border: 1px solid #d1d5db; color: #374151; padding: 8px 16px; border-radius: 6px; font-weight: 500; font-size: 14px; transition: all 0.2s; }
        .btn-white:hover { border-color: #06C755; color: #06C755; background-color: #f0fbf5; }
        .input-line { width: 100%; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px 12px; font-size: 14px; outline: none; transition: border 0.2s; }
        .modal-mask { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .modal-pop { background: white; width: 95%; height: 95%; max-width: 1300px; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 25px 50px rgba(0,0,0,0.25); }
        .section-header { font-size: 15px; font-weight: 700; color: #111827; border-left: 4px solid #06C755; padding-left: 10px; margin: 20px 0 15px; }
        .settings-box { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .status-pill-btn { @apply border rounded-lg px-3 py-2 text-left hover:bg-gray-50 transition cursor-pointer border-gray-200 block w-full; }
        
        .stat-card { @apply relative overflow-hidden bg-white p-6 rounded-2xl border border-gray-100 shadow-sm flex flex-col justify-center transition hover:shadow-md; }
        .stat-watermark { @apply absolute -right-4 -bottom-4 text-7xl opacity-10 pointer-events-none; }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex h-screen w-full">
    <!-- LOGIN 登入 -->
    <div v-if="!isLoggedIn" class="fixed inset-0 z-[1000] flex items-center justify-center bg-[#f0f2f5]">
        <div class="bg-white p-12 rounded-xl shadow-2xl w-[400px] text-center border">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">運動島管理登入</h1>
            <input v-model="password" type="password" class="input-line mb-6" placeholder="管理密碼">
            <button @click="login" :disabled="isLoading" class="w-full btn-green justify-center py-3 shadow-lg">登入系統</button>
            <p v-if="error" class="text-red-500 text-sm mt-4 font-bold">{{ error }}</p>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <template v-else>
        <aside class="sidebar">
            <div class="p-6 font-black text-xl border-b tracking-tight">運動島管理站</div>
            <div class="flex-1 py-4">
                <div class="menu-item" :class="{active: currentTab==='dashboard'}" @click="currentTab='dashboard'"><i class="fas fa-chart-pie w-6 text-center mr-2"></i> 營運統計</div>
                <div class="menu-item" :class="{active: currentTab==='courses'}" @click="currentTab='courses'"><i class="fas fa-book-open w-6 text-center mr-2"></i> 課程管理</div>
                <div class="menu-item" :class="{active: currentTab==='orders'}" @click="currentTab='orders'"><i class="fas fa-money-check-alt w-6 text-center mr-2"></i> 訂單管理</div>
                <div class="menu-item" :class="{active: currentTab==='members'}" @click="currentTab='members'"><i class="fas fa-users-cog w-6 text-center mr-2"></i> 會員管理</div>
            </div>
            <div class="p-4 border-t"><button @click="logout" class="w-full btn-white text-xs py-1">登出</button></div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h2 class="text-xl font-bold text-gray-800">{{ tabName }}</h2>
                <button @click="fetchData" class="btn-white"><i class="fas fa-sync-alt" :class="{'fa-spin':isLoading}"></i> 資料同步</button>
            </header>
            
            <div class="content-scroll">
                
                <!-- 儀表板 / 營運統計 -->
                <div v-if="currentTab==='dashboard'">
                    <div class="grid grid-cols-5 gap-4 mb-8">
                        <div class="stat-card">
                            <p class="text-xs font-bold text-gray-500 mb-2 relative z-10">總實收金額 (已完款)</p>
                            <h3 class="text-3xl font-black text-[#06C755] relative z-10">${{ dashboardStats.totalRevenue.toLocaleString() }}</h3>
                            <i class="fas fa-dollar-sign stat-watermark text-[#06C755]"></i>
                        </div>
                        <div class="stat-card">
                            <p class="text-xs font-bold text-gray-500 mb-2 relative z-10">總待收金額 (待付款)</p>
                            <h3 class="text-3xl font-black text-orange-500 relative z-10">${{ dashboardStats.pendingRevenue.toLocaleString() }}</h3>
                            <i class="fas fa-hourglass-half stat-watermark text-orange-500"></i>
                        </div>
                        <div class="stat-card">
                            <p class="text-xs font-bold text-gray-500 mb-2 relative z-10">總退款金額 (已退款)</p>
                            <h3 class="text-3xl font-black text-red-500 relative z-10">${{ dashboardStats.refundedRevenue.toLocaleString() }}</h3>
                            <i class="fas fa-hand-holding-usd stat-watermark text-red-500"></i>
                        </div>
                        <div class="stat-card">
                            <p class="text-xs font-bold text-gray-500 mb-2 relative z-10">有效報名訂單</p>
                            <h3 class="text-3xl font-black text-blue-600 relative z-10">{{ dashboardStats.totalOrders }} <span class="text-sm text-gray-400 font-bold">筆</span></h3>
                            <i class="fas fa-file-signature stat-watermark text-blue-500"></i>
                        </div>
                        <div class="stat-card">
                            <p class="text-xs font-bold text-gray-500 mb-2 relative z-10">系統總會員數</p>
                            <h3 class="text-3xl font-black text-purple-600 relative z-10">{{ dashboardStats.totalMembers }} <span class="text-sm text-gray-400 font-bold">人</span></h3>
                            <i class="fas fa-users stat-watermark text-purple-500"></i>
                        </div>
                    </div>

                    <!-- 各課程營收明細表 -->
                    <h3 class="text-lg font-bold text-gray-800 mb-4 border-l-4 border-[#06C755] pl-3">各課程營收狀態統計</h3>
                    <div class="card overflow-x-auto">
                        <table class="data-table min-w-max">
                            <thead>
                                <tr>
                                    <th class="text-left">課程名稱</th>
                                    <th class="text-center">課程類型</th>
                                    <th class="text-center">報名總數</th>
                                    <th class="text-center">應收總額</th>
                                    <th class="text-center border-l">待付人數</th>
                                    <th class="text-center">待收金額</th>
                                    <th class="text-center border-l">已付人數</th>
                                    <th class="text-center">實收金額</th>
                                    <th class="text-center border-l">退款人數</th>
                                    <th class="text-center">退款金額</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="stat in courseStats" :key="stat.id" class="hover:bg-gray-50 transition">
                                    <td class="font-bold text-gray-800 text-left">{{ stat.name }}</td>
                                    <td class="text-center">
                                        <span class="bg-blue-50 text-blue-600 px-2 py-1 rounded-md text-[11px] font-bold">{{ stat.type }}</span>
                                    </td>
                                    <td class="text-center font-bold text-gray-700 text-base">{{ stat.paidCount + stat.pendingCount }}</td>
                                    <td class="text-center font-bold text-gray-700 text-base">${{ (stat.paidRevenue + stat.pendingRevenue).toLocaleString() }}</td>
                                    <td class="text-center font-bold text-orange-500 border-l">{{ stat.pendingCount }}</td>
                                    <td class="text-center font-bold text-orange-500">${{ stat.pendingRevenue.toLocaleString() }}</td>
                                    <td class="text-center font-bold text-[#06C755] border-l">{{ stat.paidCount }}</td>
                                    <td class="text-center font-black text-[#06C755] text-lg">${{ stat.paidRevenue.toLocaleString() }}</td>
                                    <td class="text-center font-bold text-red-500 border-l">{{ stat.refundedCount }}</td>
                                    <td class="text-center font-bold text-red-500">${{ stat.refundedRevenue.toLocaleString() }}</td>
                                </tr>
                                <tr v-if="courseStats.length === 0">
                                    <td colspan="10" class="text-center py-10 text-gray-400">目前尚無課程資料</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 課程管理列表 -->
                <div v-if="currentTab==='courses'">
                    <div class="flex justify-between mb-6 items-end">
                        <div class="text-lg font-bold text-gray-600">上架課程：{{ courses.length }}</div>
                        <button @click="openAddCourse" class="btn-green shadow-sm"><i class="fas fa-plus"></i> 新增課程</button>
                    </div>
                    <div class="card overflow-x-auto">
                        <table class="data-table min-w-max">
                            <thead>
                                <tr>
                                    <th class="text-left">課程資訊</th>
                                    <th class="text-left">類型/時間</th>
                                    <th class="text-left">費用/名額</th>
                                    <th class="text-left">繳費狀況 (點擊名單)</th>
                                    <th class="text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="c in courses" :key="c.id" class="hover:bg-gray-50 transition">
                                    <td class="font-bold w-1/4 text-left text-gray-800">
                                        <div class="text-base mb-1">{{ c.name }}</div>
                                        <span class="text-sm text-gray-800 font-mono font-normal bg-gray-100 px-1.5 py-0.5 rounded">{{ c.id }}</span>
                                    </td>
                                    <td class="text-left">
                                        <span class="text-sm bg-blue-50 text-blue-700 px-2 py-0.5 rounded font-bold">{{ c.type }}</span>
                                        <div class="text-sm text-gray-800 mt-2 font-medium">{{ c.startDate }} ~ {{ c.endDate }}</div>
                                    </td>
                                    <td class="text-left">
                                        <div class="text-[#06C755] font-bold text-base mb-1">${{ c.price }}</div>
                                        <div class="text-sm text-gray-800 font-medium">{{ c.enrolled }} / {{ c.capacity }} 人</div>
                                    </td>
                                    <td class="w-56 text-left"> 
                                        <button @click="viewEnrollmentList(c)" class="status-pill-btn group">
                                            <div class="flex justify-between items-center mb-1.5">
                                                <span class="text-green-600 font-bold text-sm">已付: {{ getPaidCount(c.id) }}</span>
                                                <i class="fas fa-chevron-right text-sm text-gray-400 group-hover:text-[#06C755]"></i>
                                            </div>
                                            <div class="text-sm text-orange-600 mb-1 font-medium">待付: {{ getPendingCount(c.id) }}</div>
                                            <div class="text-sm text-red-600 font-medium" v-if="getRefundedCount(c.id) > 0">退款: {{ getRefundedCount(c.id) }}</div>
                                        </button>
                                    </td>
                                    <td class="text-right space-x-3">
                                        <!-- 新增簽到按鈕 -->
                                        <button @click="openAttendance(c)" class="text-[#06C755] hover:text-[#05b34c] bg-green-50 px-3 py-1.5 rounded-lg text-sm font-bold transition shadow-sm border border-green-100"><i class="fas fa-user-check"></i> 簽到</button>
                                        <button @click="copyCourse(c)" class="text-gray-600 hover:text-blue-600 text-sm font-bold" title="複製此課程"><i class="far fa-copy"></i> 複製</button>
                                        <button @click="openEditCourse(c)" class="text-blue-600 hover:underline text-sm font-bold"><i class="fas fa-edit"></i> 編輯</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 訂單管理列表 -->
                <div v-if="currentTab==='orders'">
                    <!-- 搜尋與過濾區塊 -->
                    <div class="bg-white p-4 rounded-xl border border-gray-200 flex flex-wrap gap-4 shadow-sm mb-6">
                         <!-- 關鍵字搜尋 -->
                         <div class="flex-1 min-w-[200px]">
                             <label class="block text-xs font-bold text-gray-500 mb-1">關鍵字搜尋</label>
                             <input v-model="searchTerm" placeholder="搜尋姓名、電話、訂單號..." class="input-line border-gray-200 shadow-none w-full">
                         </div>
                         <!-- 狀態篩選 -->
                         <div class="w-40">
                             <label class="block text-xs font-bold text-gray-500 mb-1">付款狀態篩選</label>
                             <select v-model="filterStatus" class="input-line border-gray-200 shadow-none w-full font-bold text-gray-700">
                                 <option value="ALL">全部狀態</option>
                                 <option value="PENDING">待付款</option>
                                 <option value="PAID">已完款</option>
                                 <option value="REFUNDED">已退款</option>
                                 <option value="CANCELLED">已取消</option>
                             </select>
                         </div>
                         <!-- 課程篩選 -->
                         <div class="w-72">
                             <label class="block text-xs font-bold text-gray-500 mb-1">課程活動篩選</label>
                             <select v-model="filterCourse" class="input-line border-gray-200 shadow-none w-full font-bold text-gray-700">
                                 <option value="ALL">全部課程 (不限)</option>
                                 <option v-for="c in courses" :key="c.id" :value="c.id">{{ c.name }}</option>
                             </select>
                         </div>
                    </div>

                    <div class="card overflow-x-auto">
                        <table class="data-table min-w-max">
                            <thead>
                                <tr>
                                    <th class="text-left">單號</th>
                                    <th class="text-left">報名課程</th>
                                    <th class="text-left">學員</th>
                                    <th class="text-center">金額</th>
                                    <th class="text-center">狀態</th>
                                    <th class="text-center">後五碼</th>
                                    <th class="text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="o in filteredOrders" :key="o.orderId" class="hover:bg-gray-50 transition">
                                    <td class="text-sm font-mono text-left text-gray-800 font-bold">{{ o.orderId.slice(0,8) }}</td>
                                    <td class="font-bold text-left text-gray-800 text-base">{{ getCourseName(o.courseId) }}</td>
                                    <td class="font-bold text-left text-gray-800 text-base">{{ o.name }}<br><span class="text-sm text-gray-800 font-normal">{{ o.phone }}</span></td>
                                    <td class="text-[#06C755] font-bold text-center text-base">${{ o.amount }}</td>
                                    <td class="text-center"><span :class="getStatusClass(o.status)" class="px-2 py-1 rounded text-sm font-bold inline-block">{{ getStatusLabel(o.status) }}</span></td>
                                    <td class="font-mono text-center text-blue-600 font-bold text-base">{{ o.remittance || '-' }}</td>
                                    <td class="text-right"><button @click="openOrder(o)" class="btn-white text-sm font-bold">編輯</button></td>
                                </tr>
                                <tr v-if="filteredOrders.length === 0"><td colspan="7" class="text-center py-20 text-gray-400 font-bold">找不到符合條件的訂單</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 會員管理列表 -->
                <div v-if="currentTab==='members'">
                    <div class="mb-6 relative max-w-md"><input v-model="searchMemberTerm" class="input-line pl-10" placeholder="搜尋會員姓名、身分證..."><i class="fas fa-search absolute left-3 top-3 text-gray-400"></i></div>
                    <div class="card overflow-x-auto">
                        <table class="data-table min-w-max">
                            <thead><tr><th class="text-left">姓名</th><th class="text-center">手機</th><th class="text-center">身分證</th><th class="text-center">家人數</th><th class="text-right">操作</th></tr></thead>
                            <tbody>
                                <tr v-for="u in filteredUsers" :key="u.userId" class="hover:bg-gray-50 transition">
                                    <td class="font-bold text-left text-gray-800 text-base">{{ u.name }}</td>
                                    <td class="text-center text-gray-800 font-medium text-sm">{{ u.phone }}</td>
                                    <td class="font-mono text-gray-800 text-center font-bold text-sm">{{ u.nationalId }}</td>
                                    <td class="text-center"><span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-bold">{{ u.familyMembers?.length || 0 }}</span></td>
                                    <td class="text-right"><button @click="openMember(u)" class="text-blue-600 hover:underline font-bold text-sm">詳情</button></td>
                                </tr>
                                <tr v-if="filteredUsers.length === 0"><td colspan="5" class="text-center py-20 text-gray-400 font-bold">目前尚無會員資料</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </template>

    <!-- --- MODALS --- -->

    <!-- 新增：簽到管理彈窗 -->
    <div v-if="showAttendanceModal" class="modal-mask">
        <div class="modal-pop" style="max-width:800px; height:85%;">
            <div class="h-14 border-b px-6 flex justify-between items-center shrink-0 bg-white shadow-sm">
                <h3 class="font-black text-lg text-gray-800"><i class="fas fa-user-check text-[#06C755] mr-2"></i>簽到管理 - {{ attendanceCourse?.name }}</h3>
                <button @click="showAttendanceModal=false" class="text-gray-400 hover:text-red-500 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="p-4 bg-white border-b flex flex-wrap items-center gap-4 shrink-0 shadow-sm z-10">
                <label class="font-bold text-gray-700 text-sm">選擇上課日期：</label>
                <input type="date" v-model="attendanceDate" @change="loadAttendanceList" class="input-line w-48 font-bold text-base text-[#06C755]">
                <span class="text-sm font-bold text-gray-500 ml-auto bg-gray-100 px-3 py-1 rounded-full">共 {{ attendanceList.length }} 位學員</span>
            </div>

            <div class="flex-1 overflow-y-auto p-4 bg-[#f9fafb]">
                <div class="card shadow-sm border border-gray-200">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="text-left w-1/4">學員姓名</th>
                                <th class="text-center w-1/4">聯絡電話</th>
                                <th class="text-center">出席狀態設定</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="p in attendanceList" :key="p.orderId" class="hover:bg-gray-50 transition border-b border-gray-100">
                                <td class="font-bold text-gray-800 text-base">{{ p.name }}</td>
                                <td class="text-center text-gray-600 font-medium">{{ p.phone }}</td>
                                <td class="text-center">
                                    <div class="inline-flex rounded-lg shadow-sm" role="group">
                                        <button @click="p.status='PRESENT'" type="button" :class="p.status==='PRESENT' ? 'bg-green-500 text-white border-green-500 z-10' : 'bg-white text-gray-700 border-gray-200 hover:bg-gray-50'" class="px-5 py-2 text-sm font-bold border rounded-l-lg transition focus:outline-none">出席</button>
                                        <button @click="p.status='ABSENT'" type="button" :class="p.status==='ABSENT' ? 'bg-red-500 text-white border-red-500 z-10' : 'bg-white text-gray-700 border-gray-200 border-l-0 hover:bg-gray-50'" class="px-5 py-2 text-sm font-bold border transition focus:outline-none">缺席</button>
                                        <button @click="p.status='LEAVE'" type="button" :class="p.status==='LEAVE' ? 'bg-yellow-500 text-white border-yellow-500 z-10' : 'bg-white text-gray-700 border-gray-200 border-l-0 hover:bg-gray-50'" class="px-5 py-2 text-sm font-bold border rounded-r-lg transition focus:outline-none">請假</button>
                                    </div>
                                    <button v-if="p.status !== 'NONE'" @click="p.status='NONE'" class="ml-4 text-xs text-gray-400 hover:text-gray-600 font-bold underline transition focus:outline-none">清除</button>
                                </td>
                            </tr>
                            <tr v-if="attendanceList.length === 0">
                                <td colspan="3" class="text-center py-20 text-gray-400 font-bold text-base">此課程目前尚無有效報名學員</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="h-16 border-t px-6 flex justify-end items-center bg-white gap-3 shrink-0 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20">
                <button @click="showAttendanceModal=false" class="btn-white px-8">取消返回</button>
                <button @click="saveAttendance" :disabled="isLoading" class="btn-green px-10 text-lg"><i class="fas fa-save mr-1"></i>儲存簽到表</button>
            </div>
        </div>
    </div>

    <!-- 1. 報名名單彈窗 -->
    <div v-if="showEnrollmentModal" class="modal-mask">
        <div class="modal-pop" style="max-width:900px; height:80%;">
            <div class="h-14 border-b px-6 flex justify-between items-center shrink-0 bg-white shadow-sm">
                <h3 class="font-black text-lg text-gray-800"><i class="fas fa-users text-[#06C755] mr-2"></i>{{ currentViewingCourseName }} - 報名名單</h3>
                <button @click="showEnrollmentModal=false" class="text-gray-400 hover:text-red-500 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-[#f9fafb]">
                <div class="card shadow-none">
                    <table class="data-table">
                        <thead><tr><th class="text-left">學員姓名</th><th class="text-center">聯絡電話</th><th class="text-center">應收金額</th><th class="text-center">付款狀態</th><th class="text-center">匯款末五碼</th><th class="text-right">操作</th></tr></thead>
                        <tbody>
                            <tr v-for="p in selectedCourseEnrollment" :key="p.orderId">
                                <td class="font-bold text-left text-gray-800 text-base">{{ p.name }}</td>
                                <td class="text-sm text-gray-800 text-center font-medium">{{ p.phone }}</td>
                                <td class="font-bold text-gray-800 text-center text-base">${{ p.amount }}</td>
                                <td class="text-center"><span :class="getStatusClass(p.status)" class="px-2 py-1.5 rounded text-xs font-bold inline-block">{{ getStatusLabel(p.status) }}</span></td>
                                <td class="font-mono text-blue-600 font-bold text-center text-base">{{ p.remittance || '-' }}</td>
                                <td class="text-right"><button @click="openOrderFromList(p)" class="text-blue-600 text-sm font-bold hover:bg-blue-100 bg-blue-50 px-3 py-1.5 rounded-lg transition">編輯訂單</button></td>
                            </tr>
                            <tr v-if="selectedCourseEnrollment.length === 0"><td colspan="6" class="text-center py-20 text-gray-400 font-bold">目前尚無人報名此課程</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="h-16 border-t px-6 flex justify-end items-center bg-white"><button @click="showEnrollmentModal=false" class="btn-white px-8">關閉名單</button></div>
        </div>
    </div>

    <!-- 2. 課程編輯 -->
    <div v-if="showCourseModal" class="modal-mask">
        <div class="modal-pop" style="max-width:1000px; height:85%;">
            <div class="h-14 border-b px-6 flex justify-between items-center shrink-0 bg-white"><h3 class="font-black text-lg text-gray-800">{{ isEditingCourse ? '編輯課程詳情' : '建立新課程' }}</h3><button @click="showCourseModal=false" class="text-gray-400 hover:rotate-90 transition duration-200"><i class="fas fa-times text-xl"></i></button></div>
            <div class="flex-1 flex overflow-hidden">
                <div class="w-1/2 p-6 overflow-y-auto border-r bg-white">
                    <div class="section-header">基本資訊</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">課程 ID</label><input v-model="courseForm.id" class="input-line" :readonly="isEditingCourse"></div>
                        <div><label class="label-line">課程名稱</label><input v-model="courseForm.name" class="input-line"></div>
                        <div><label class="label-line">類型</label><select v-model="courseForm.type" class="input-line"><option value="單日課程">單日課程</option><option value="多日營隊">多日營隊</option><option value="常態課後">常態課後</option></select></div>
                        <div><label class="label-line">時段</label><select v-model="courseForm.timeSlotType" class="input-line"><option value="全日">全日 (09:00-16:00)</option><option value="上午">上午 (09:00-12:00)</option><option value="下午">下午 (13:30-16:30)</option><option value="晚間">晚間</option></select></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">開始日期</label><input v-model="courseForm.startDate" type="date" class="input-line"></div>
                        <div><label class="label-line">結束日期</label><input v-model="courseForm.endDate" type="date" class="input-line"></div>
                        <div><label class="label-line">開始時間</label><input v-model="courseForm.startTime" type="time" class="input-line"></div>
                        <div><label class="label-line">結束時間</label><input v-model="courseForm.endTime" type="time" class="input-line"></div>
                    </div>
                    <div class="section-header">地點與師資</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">上課地點</label><input v-model="courseForm.location" class="input-line"></div>
                        <div><label class="label-line">教練/老師</label><input v-model="courseForm.instructor" class="input-line"></div>
                    </div>
                </div>
                <div class="w-1/2 p-6 overflow-y-auto bg-[#fafafa]">
                    <div class="section-header">費用與設定</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">原價</label><input v-model="courseForm.price" type="number" class="input-line font-bold text-[#06C755]"></div>
                        <div><label class="label-line">總名額</label><input v-model="courseForm.capacity" type="number" class="input-line"></div>
                        <div><label class="label-line">總堂數 (計算請假用)</label><input v-model="courseForm.totalSessions" type="number" class="input-line"></div>
                    </div>
                    <div class="settings-box">
                        <div class="font-bold text-xs mb-3 text-orange-600 flex items-center"><i class="fas fa-bolt mr-1"></i> 早鳥優惠</div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="label-line">早鳥價</label><input v-model="courseForm.earlyBirdPrice" type="number" class="input-line"></div>
                            <div><label class="label-line">截止日</label><input v-model="courseForm.earlyBirdDate" type="date" class="input-line"></div>
                        </div>
                    </div>
                    <div class="section-header flex justify-between items-center"><span>設備項目</span><button @click="addEquipment" class="text-xs bg-green-100 text-green-700 px-3 py-1.5 rounded-full font-bold hover:bg-green-200 transition"><i class="fas fa-plus mr-1"></i>新增設備</button></div>
                    <div v-for="(eq, idx) in courseEquipments" :key="idx" class="flex gap-2 items-center bg-white p-2.5 rounded-lg border mb-2 shadow-sm">
                        <input v-model="eq.name" placeholder="名稱" class="input-line text-xs flex-1">
                        <input v-model="eq.price" type="number" placeholder="金額" class="input-line text-xs w-24 text-center">
                        <button @click="removeEquipment(idx)" class="text-red-400 px-3 hover:text-red-600 transition"><i class="fas fa-trash"></i></button>
                    </div>
                    <div v-if="courseEquipments.length === 0" class="text-center py-4 text-xs text-gray-400 border-2 border-dashed rounded-lg mb-4">目前無任何租借設備項目</div>
                    
                    <div class="section-header">宣傳與說明</div>
                    <div class="mb-4"><label class="label-line">圖片 URL</label><input v-model="courseForm.image" class="input-line text-xs"></div>
                    <textarea v-model="courseForm.description" rows="4" class="input-line text-sm"></textarea>
                </div>
            </div>
            <div class="h-16 border-t px-8 flex justify-end items-center gap-4 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-10"><button @click="showCourseModal=false" class="btn-white px-8">取消</button><button @click="saveCourse" :disabled="isLoading" class="btn-green px-12">{{ isLoading ? '儲存中...' : '確認儲存' }}</button></div>
        </div>
    </div>

    <!-- 3. 會員詳情視窗 -->
    <div v-if="showMemberModal" class="modal-mask">
        <div class="modal-pop" style="max-width:900px; height:75%;">
            <div class="h-14 border-b px-6 flex justify-between items-center shrink-0 bg-white"><h3 class="font-bold">會員資料管理</h3><button @click="showMemberModal=false"><i class="fas fa-times text-xl text-gray-400"></i></button></div>
            <div class="flex-1 flex overflow-hidden">
                <div class="w-1/2 p-6 overflow-y-auto border-r bg-white">
                    <div class="section-header text-[#06C755]"><i class="fas fa-user mr-1"></i> 主帳號資料</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">姓名</label><input v-model="editingMember.name" class="input-line"></div>
                        <div><label class="label-line text-gray-400">身分證 (不可修改)</label><input v-model="editingMember.nationalId" class="input-line bg-gray-50" readonly></div>
                        <div><label class="label-line">性別</label><select v-model="editingMember.gender" class="input-line"><option value="男">男</option><option value="女">女</option></select></div>
                        <div><label class="label-line">生日</label><input v-model="editingMember.birthday" type="date" class="input-line"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="label-line">聯絡電話</label><input v-model="editingMember.phone" class="input-line"></div>
                        <div><label class="label-line">居住地址</label><input v-model="editingMember.address" class="input-line"></div>
                    </div>
                    <div><label class="label-line text-blue-600">健康備註 (對外顯示)</label><textarea v-model="editingMember.healthNote" rows="3" class="input-line"></textarea></div>
                </div>
                <div class="w-1/2 p-6 overflow-y-auto bg-[#f9fafb]">
                    <div class="section-header text-[#e85d04]"><i class="fas fa-users mr-1"></i> 家人名單 (共 {{ editingMember.familyMembers?.length || 0 }} 人)</div>
                    <div v-for="fm in editingMember.familyMembers" :key="fm.userId" class="bg-white p-4 rounded-xl border mb-3 shadow-sm relative group hover:border-blue-200 transition">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-gray-800 text-base">{{ fm.name }}</h4>
                            <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-bold">{{ fm.relation }}</span>
                        </div>
                        <div class="flex gap-4 text-xs text-gray-500 mb-1">
                            <span><i class="far fa-id-card w-4 text-center"></i> {{ fm.nationalId }}</span>
                            <span><i class="fas fa-birthday-cake w-4 text-center"></i> {{ fm.birthday }}</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            <span><i class="fas fa-venus-mars w-4 text-center"></i> {{ fm.gender }}</span>
                            <span v-if="fm.school" class="ml-3"><i class="fas fa-school w-4 text-center"></i> {{ fm.school }} {{ fm.grade }}</span>
                        </div>
                        <button @click="openRelativeEdit(fm)" class="absolute bottom-4 right-4 text-blue-500 hover:bg-blue-50 w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition shadow-sm border border-blue-100"><i class="fas fa-edit"></i></button>
                    </div>
                    <div v-if="!editingMember.familyMembers?.length" class="text-center py-10 text-gray-400">目前無關聯家人</div>
                </div>
            </div>
            <div class="h-16 border-t px-6 flex justify-end items-center gap-3 bg-white shadow-lg z-10"><button @click="showMemberModal=false" class="btn-white px-8">取消</button><button @click="saveMember" class="btn-green px-10">確認儲存主帳號</button></div>
        </div>
    </div>

    <!-- 4. 子女編輯彈窗 -->
    <div v-if="showRelativeModal" class="modal-mask" style="z-index: 10000;">
        <div class="modal-pop" style="max-width:400px; height: auto;">
            <div class="h-14 px-6 border-b flex justify-between items-center bg-white shadow-sm"><b>修改子女資訊</b><button @click="showRelativeModal=false"><i class="fas fa-times text-gray-400"></i></button></div>
            <div class="p-6 space-y-4 bg-[#fafafa]">
                <div><label class="label-line">姓名</label><input v-model="editingRelative.name" class="input-line"></div>
                <div><label class="label-line">關係</label><input v-model="editingRelative.relation" class="input-line" placeholder="如：長子"></div>
                <div><label class="label-line text-gray-400">身分證 (不可修改)</label><input v-model="editingRelative.nationalId" class="input-line bg-gray-100" readonly></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-line">性別</label><select v-model="editingRelative.gender" class="input-line"><option value="男">男</option><option value="女">女</option></select></div>
                    <div><label class="label-line">生日</label><input v-model="editingRelative.birthday" type="date" class="input-line"></div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-line">學校</label><input v-model="editingRelative.school" class="input-line" placeholder="如：竹北國小"></div>
                    <div><label class="label-line">年級</label><input v-model="editingRelative.grade" class="input-line" placeholder="如：三年級"></div>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end gap-2 bg-white"><button @click="showRelativeModal=false" class="btn-white">取消</button><button @click="saveRelative" class="btn-green px-8">確認修改</button></div>
        </div>
    </div>

    <!-- 5. 訂單狀態編輯 -->
    <div v-if="showOrderModal" class="modal-mask" style="z-index: 10000;">
        <div class="modal-pop" style="max-width:450px; height: auto;">
            <div class="h-14 px-6 border-b flex justify-between items-center bg-white shadow-sm"><b>訂單狀態維修</b><button @click="showOrderModal=false"><i class="fas fa-times text-gray-400"></i></button></div>
            <div class="p-6 space-y-5 bg-[#fafafa]">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="label-line">狀態</label>
                        <select v-model="editingOrder.status" class="input-line">
                            <option value="PENDING">待付款</option>
                            <option value="PAID">已完款</option>
                            <option value="REFUNDED">已退款</option>
                            <option value="CANCELLED">已取消</option>
                        </select>
                    </div>
                    <div><label class="label-line">實收金額</label><input v-model="editingOrder.amount" type="number" class="input-line font-bold text-[#06C755]"></div>
                </div>
                <div><label class="label-line">匯款後五碼</label><input v-model="editingOrder.remittance" class="input-line font-mono text-center tracking-widest" maxlength="5"></div>
                <div><label class="label-line">備註</label><textarea v-model="editingOrder.note" class="input-line" rows="2" placeholder="可填入管理員手動調整的備註 (如：請假2天)"></textarea></div>
            </div>
            <div class="p-4 border-t flex justify-end gap-3 bg-white"><button @click="showOrderModal=false" class="btn-white">取消</button><button @click="saveOrder" class="btn-green px-8">更新狀態</button></div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;
    const API_ENDPOINT = 'https://sport-island.fangwl591021.workers.dev/'; 

    createApp({
        setup() {
            const isLoggedIn=ref(false), password=ref(''), isLoading=ref(false), error=ref('');
            const currentTab=ref('orders'); 
            const courses=ref([]), orders=ref([]), users=ref([]);
            
            const searchTerm=ref(''); 
            const filterStatus=ref('ALL');
            const filterCourse=ref('ALL');
            const searchMemberTerm=ref('');
            
            const showCourseModal=ref(false), isEditingCourse=ref(false), courseForm=ref({}), courseEquipments=ref([]);
            const showMemberModal=ref(false), editingMember=ref({});
            const showOrderModal=ref(false), editingOrder=ref({});
            const showRelativeModal=ref(false), editingRelative=ref({});
            
            const showEnrollmentModal = ref(false), selectedCourseEnrollment = ref([]), currentViewingCourseName = ref('');

            // --- 新增：簽到系統狀態 ---
            const showAttendanceModal = ref(false);
            const attendanceCourse = ref(null);
            const attendanceDate = ref('');
            const attendanceList = ref([]);

            const callApi = async (action, payload={}) => {
                const res = await fetch(API_ENDPOINT, { method:'POST', body:JSON.stringify({action, payload:{password:password.value, ...payload}}) });
                const json = await res.json();
                if(json.status!=='success') throw new Error(json.message);
                return json.data;
            };

            const login = async () => { isLoading.value=true; try { await callApi('ADMIN_LOGIN'); isLoggedIn.value=true; fetchData(); } catch(e){ error.value='密碼錯誤'; } finally { isLoading.value=false; } };
            const logout = () => { isLoggedIn.value=false; password.value=''; };
            const fetchData = async () => { isLoading.value=true; try { const d = await callApi('ADMIN_GET_DATA'); courses.value=d.courses; orders.value=d.orders.reverse(); users.value=d.users; } catch(e){ alert('載入失敗'); } finally { isLoading.value=false; } };

            const dashboardStats = computed(() => {
                let totalRev = 0, pendingRev = 0, refundedRev = 0, validOrdersCount = 0;
                orders.value.forEach(o => {
                    if (o.status === 'PAID') { totalRev += Number(o.amount) || 0; validOrdersCount++; } 
                    else if (o.status === 'PENDING') { pendingRev += Number(o.amount) || 0; validOrdersCount++; }
                    else if (o.status === 'REFUNDED') { refundedRev += Number(o.amount) || 0; }
                });
                return { totalRevenue: totalRev, pendingRevenue: pendingRev, refundedRevenue: refundedRev, totalOrders: validOrdersCount, totalMembers: users.value.length };
            });

            const courseStats = computed(() => {
                return courses.value.map(c => {
                    const cOrders = orders.value.filter(o => o.courseId === c.id);
                    let paidCnt = 0, pendingCnt = 0, refundedCnt = 0, paidRev = 0, pendingRev = 0, refundedRev = 0;
                    cOrders.forEach(o => {
                        if(o.status === 'PAID') { paidCnt++; paidRev += Number(o.amount) || 0; } 
                        else if(o.status === 'PENDING') { pendingCnt++; pendingRev += Number(o.amount) || 0; }
                        else if(o.status === 'REFUNDED') { refundedCnt++; refundedRev += Number(o.amount) || 0; }
                    });
                    return { id: c.id, name: c.name, type: c.type, paidCount: paidCnt, pendingCount: pendingCnt, refundedCount: refundedCnt, paidRevenue: paidRev, pendingRevenue: pendingRev, refundedRevenue: refundedRev };
                });
            });

            const getCourseName = (courseId) => { const c = courses.value.find(c => c.id === courseId); return c ? c.name : '未知課程 (' + courseId + ')'; };
            const getPaidCount = (courseId) => orders.value.filter(o => o.courseId === courseId && o.status === 'PAID').length;
            const getPendingCount = (courseId) => orders.value.filter(o => o.courseId === courseId && o.status === 'PENDING').length;
            const getRefundedCount = (courseId) => orders.value.filter(o => o.courseId === courseId && o.status === 'REFUNDED').length;

            const viewEnrollmentList = (course) => { currentViewingCourseName.value = course.name; selectedCourseEnrollment.value = orders.value.filter(o => o.courseId === course.id); showEnrollmentModal.value = true; };
            const openOrderFromList = (order) => { editingOrder.value = {...order}; showOrderModal.value = true; };

            const fmtDate = d => { if (!d || d === '-') return ''; if (typeof d === 'string' && d.length >= 10) return d.substring(0, 10); return d; };
            const fmtTime = (t) => {
                if (!t) return ''; const s = String(t).trim();
                if (s.includes('T')) { const d = new Date(s); if (!isNaN(d.getTime())) return `${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`; }
                if (s.includes(':')) { const p = s.split(':'); return `${p[0].padStart(2, '0')}:${p[1].padStart(2, '0')}`; }
                return s;
            };

            const openAddCourse = () => { isEditingCourse.value=false; courseForm.value={id:'', name:'', startDate:'', endDate:'', price:0, capacity:0, totalSessions:1, type:'單日課程', timeSlotType:'全日', earlyBirdPrice:0, earlyBirdDate:'', equipmentJson:'[]'}; courseEquipments.value=[]; showCourseModal.value=true; };
            const openEditCourse = (c) => { isEditingCourse.value=true; courseForm.value = { ...c, startDate: fmtDate(c.startDate), endDate: fmtDate(c.endDate), startTime: fmtTime(c.startTime), endTime: fmtTime(c.endTime) }; try { courseEquipments.value = JSON.parse(c.equipmentJson || '[]'); } catch(e){ courseEquipments.value=[]; } showCourseModal.value=true; };
            const copyCourse = (c) => { isEditingCourse.value=false; courseForm.value = { ...c, id: '', name: c.name + ' (複製)', startDate: fmtDate(c.startDate), endDate: fmtDate(c.endDate), startTime: fmtTime(c.startTime), endTime: fmtTime(c.endTime) }; try { courseEquipments.value = JSON.parse(c.equipmentJson || '[]'); } catch(e){ courseEquipments.value=[]; } showCourseModal.value=true; };

            const addEquipment = () => { courseEquipments.value.push({name:'', price:0}); };
            const removeEquipment = (i) => { courseEquipments.value.splice(i, 1); };
            const saveCourse = async () => { isLoading.value=true; try { courseForm.value.equipmentJson = JSON.stringify(courseEquipments.value); const act = isEditingCourse.value ? 'ADMIN_UPDATE_COURSE' : 'ADMIN_ADD_COURSE'; await callApi(act, courseForm.value); alert('成功'); showCourseModal.value=false; fetchData(); } catch(e){ alert('失敗'); } finally { isLoading.value=false; } };

            const openMember = (u) => { editingMember.value = JSON.parse(JSON.stringify(u)); editingMember.value.birthday = fmtDate(editingMember.value.birthday); showMemberModal.value=true; };
            const saveMember = async () => { try { await callApi('ADMIN_UPDATE_MEMBER', {memberData:editingMember.value}); alert('成功'); showMemberModal.value=false; fetchData(); } catch(e){ alert('錯誤'); } };
            const openRelativeEdit = (fm) => { editingRelative.value = JSON.parse(JSON.stringify(fm)); editingRelative.value.birthday = fmtDate(editingRelative.value.birthday); showRelativeModal.value=true; };
            const saveRelative = async () => { try { await callApi('ADMIN_UPDATE_MEMBER', {memberData:editingRelative.value}); alert('已更新'); showRelativeModal.value=false; fetchData(); } catch(e){ alert('錯誤'); } };

            const openOrder = (o) => { editingOrder.value = {...o}; showOrderModal.value=true; };
            const saveOrder = async () => { try { await callApi('ADMIN_UPDATE_ORDER', {orderData:editingOrder.value}); alert('成功'); showOrderModal.value=false; fetchData(); } catch(e){ alert('失敗'); } };

            // --- 新增：簽到管理邏輯 ---
            const loadAttendanceList = () => {
                if (!attendanceCourse.value) return;
                // 篩選出該課程有效訂單 (排除已取消與退款)
                const courseOrders = orders.value.filter(o => o.courseId === attendanceCourse.value.id && !['CANCELLED', 'REFUNDED'].includes(o.status));
                
                attendanceList.value = courseOrders.map(o => {
                    const att = o.extraData?.attendance || {};
                    return {
                        orderId: o.orderId,
                        name: o.name,
                        phone: o.phone,
                        status: att[attendanceDate.value] || 'NONE'
                    };
                });
            };

            const openAttendance = (c) => {
                attendanceCourse.value = c;
                // 預設當天日期 (YYYY-MM-DD)
                attendanceDate.value = new Date().toISOString().split('T')[0];
                loadAttendanceList();
                showAttendanceModal.value = true;
            };

            const saveAttendance = async () => {
                isLoading.value = true;
                try {
                    await callApi('ADMIN_UPDATE_ATTENDANCE', {
                        courseId: attendanceCourse.value.id,
                        date: attendanceDate.value,
                        // 只需要傳送有更動或有狀態的項目
                        attendanceData: attendanceList.value.map(a => ({ orderId: a.orderId, status: a.status }))
                    });
                    alert('簽到資料已成功儲存！');
                    showAttendanceModal.value = false;
                    fetchData(); // 重新拉取最新的資料 (包含簽到狀態)
                } catch (e) {
                    alert('儲存失敗：' + e.message);
                } finally {
                    isLoading.value = false;
                }
            };

            const tabName = computed(() => ({'dashboard':'營運統計', 'courses':'課程管理','orders':'訂單管理','members':'會員管理'}[currentTab.value]));
            
            const filteredOrders = computed(() => { 
                let res = orders.value;
                if (filterStatus.value !== 'ALL') res = res.filter(o => o.status === filterStatus.value);
                if (filterCourse.value !== 'ALL') res = res.filter(o => o.courseId === filterCourse.value);
                const s = searchTerm.value.toLowerCase(); 
                if (s) res = res.filter(o => String(o.name || '').toLowerCase().includes(s) || String(o.phone || '').toLowerCase().includes(s) || String(o.orderId || '').toLowerCase().includes(s)); 
                return res;
            });
            const filteredUsers = computed(() => { const s = searchMemberTerm.value.toLowerCase(); return users.value.filter(u => String(u.name || '').includes(s) || String(u.nationalId || '').includes(s) || String(u.phone || '').includes(s)); });

            const getStatusLabel = s => ({'PENDING':'待付款','PAID':'已完款','REFUNDED':'已退款','CANCELLED':'已取消'}[s]||s);
            const getStatusClass = s => ({'PENDING':'bg-yellow-100 text-yellow-800','PAID':'bg-green-100 text-green-800','REFUNDED':'bg-red-100 text-red-800','CANCELLED':'bg-gray-100 text-gray-500'}[s]);

            return { 
                isLoggedIn, password, isLoading, error, currentTab, tabName, courses, orders, users, 
                searchTerm, searchMemberTerm, filteredOrders, filteredUsers, filterStatus, filterCourse,
                dashboardStats, courseStats, getCourseName,
                showCourseModal, isEditingCourse, courseForm, courseEquipments, 
                showMemberModal, editingMember, showOrderModal, editingOrder, showRelativeModal, editingRelative, 
                showEnrollmentModal, selectedCourseEnrollment, currentViewingCourseName,
                
                // 簽到管理匯出變數
                showAttendanceModal, attendanceCourse, attendanceDate, attendanceList,
                openAttendance, loadAttendanceList, saveAttendance,

                login, logout, fetchData, openAddCourse, openEditCourse, copyCourse, addEquipment, removeEquipment, saveCourse, 
                openMember, saveMember, openOrder, saveOrder, openRelativeEdit, saveRelative, 
                getStatusLabel, getStatusClass, getPaidCount, getPendingCount, getRefundedCount, viewEnrollmentList, openOrderFromList,
                formatTime: d => d ? new Date(d).toLocaleString('zh-TW',{hour12:false}) : '-'
            };
        }
    }).mount('#app');
</script>
</body>
</html>
